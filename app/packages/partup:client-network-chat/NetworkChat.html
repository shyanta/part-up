<template name="NetworkChat">
    <div class="pu-chat">
        <main>
            <header data-preventscroll>
                <form class="pu-form pu-flexible-center" novalidate>
                    <div>
                        <span>
                            <h2 class="pu-title">
                                {{_ 'pages-app-network-chat-title' }}
                            </h2>
                        </span>
                    </div>
                    <div class="pu-sub-center" data-flexible-center>
                        <span>
                            <div class="pu-searchinput">
                                <input type="text" placeholder="Search a message in this chat" class="pu-input form-control" data-search>
                                <i class="picon-search"></i>
                                <i class="picon-times" data-clear></i>
                            </div>
                        </span>
                    </div>
                </form>
            </header>
            <article class="pu-chat-wrapper" data-reversed-scroller-wrapper>
                {{#if data.messages.new.length}}{{#if state.overscroll}}
                    <p class="pu-textline pu-textline-colour pu-textline-hover">
                        <span data-scrollto>
                            New messages
                            <i class="picon-arrow-up"></i>
                        </span>
                    </p>
                {{/if}}{{/if}}
                <div data-preventscroll data-reversed-scroller>
                    {{#each data.messagesGroupedByDay data.messages.old}}
                        <p class="pu-textline pu-textline-light">
                            <span>{{ partupDayOfWeek day }} {{ partupDateDayMonthYear day }}</span>
                        </p>
                        {{#each data.messagesGroupedByUser messages}}
                            {{> ChatMessage data=.}}
                        {{/each}}
                    {{/each}}
                    {{#if data.messages.new.length}}
                        <p class="pu-textline pu-textline-colour" data-new-messages-divider>
                            <span>
                                New messages
                                <i class="picon-arrow-down"></i>
                            </span>
                        </p>
                    {{/if}}
                    {{#each data.messagesGroupedByDay data.messages.new}}
                        <p class="pu-textline pu-textline-light">
                            <span>{{ partupDayOfWeek day }} {{ partupDateDayMonthYear day }}</span>
                        </p>
                        {{#each data.messagesGroupedByUser messages}}
                            {{> ChatMessage data=.}}
                        {{/each}}
                    {{/each}}

                </div>
                {{#if data.messages.new.length}}{{#if state.underscroll}}
                    <p class="pu-textline pu-textline-colour pu-textline-hover">
                        <span data-scrollto>
                            New messages
                            <i class="picon-arrow-down"></i>
                        </span>
                    </p>
                {{/if}}{{/if}}
            </article>
            <footer data-preventscroll>
                <label class="pu-formfield">
                    <div class="pu-sub-tablecell-input">
                        <span class="pu-sub-input">
                            <input data-submit="return" data-messageinput type="text" name="partup_name" placeholder="{{_ 'pages-app-network-chat-placeholder' }}" class="pu-input form-control" autocomplete="off">
                        </span>
                        <span class="pu-sub-error"></span>
                    </div>
                    <div class="pu-sub-tablecell-button">
                        <button type="button" class="pu-button" data-send>
                            <span>{{_ 'pages-app-network-chat-button-send' }}</span>
                        </button>
                    </div>
                </label>
            </footer>
        </main>
        <aside class="pu-sidebar">
            <section>
                <div class="pu-sidebar-wrap" data-preventscroll>
                    <section>
                        <p>{{{_ 'pages-app-network-chat-sidebar-text' }}}</p>
                    </section>
                    <section>
                        <h2>Active uppers</h2>
                        {{#if data.activeUppers.count}}
                            <ul class="pu-list pu-list-users">
                                {{#each data.activeUppers}}
                                <li>
                                    <a href="{{ pathFor route='profile' _id=_id}}" data-hovercontainer="HoverContainer_upper" data-hovercontainer-context="{{_id}}">
                                        <figure class="pu-avatar pu-avatar-online" style="background-image:url('{{ partupImageUrl id=profile.image store='360x360'}}');"></figure>
                                        <p>{{ profile.name }}</p>
                                        {{#if partupContainsOneInArray _id data.chat.started_typing}}
                                            {{>NetworkChat_typing_indicator}}
                                        {{/if}}
                                    </a>
                                </li>
                                {{/each}}
                                <li>And you</li>
                            </ul>
                        {{else}}
                            <p>{{_ 'pages-app-network-chat-activeuppers-label' }}</p>
                        {{/if}}
                    </section>
                </div>
            </section>
        </aside>
    </div>
</template>

<template name="NetworkChat_typing_indicator">
    <span class="pu-typing">
        <span></span>
        <span></span>
        <span></span>
    </span>
</template>
